<div id="clientes" v-cloak>

  <div class="text-center">
    <h1>Clientes</h1>
  </div>
  <form action="">
    <div class="col">
      <div class="row">
        <div class="col-5">
          <div class="input-group">
            <div class="input-goup-prepend">
              <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">Filtros</button>
              <div class="dropdown-menu p-4">
                <form>
                  <!--Form del Filtro-->
                  <div class="form-group">
                    <label for="busquedaPorNombreEmpresa">Nombre: </label>
                    <input type="text" class="form-control" id="l_nomEmpresa" placeholder="Nombre de la Empresa"
                      maxlength="20">
                  </div>
                  <div class="form-group">
                    <label for="busquedaPorTelefono">Teléfono: </label>
                    <input type="text" class="form-control" id="l_Telefono" placeholder="Teléfono" maxlength="9">
                  </div>
                  <div class="form-group">
                    <label for="busquedaPorTelefono">Correo: </label>
                    <input type="text" class="form-control" id="l_email" placeholder="Correo Electrónico"
                      maxlength="20">
                  </div>
                </form>
              </div>
            </div>
            <input type="text" name="Buscar Cliente" id="l_cliente" placeholder="Buscar Cliente" class="form-control">
            <div class="input-group-append">
              <span class="input-group-text"><i class="fa fa-search"></i></span>
            </div>
          </div>
        </div>
      </div>

      <br>

      <div class="row">
        <div class="col">
          <table class="table table-hover table-striped table-bordered">
            <thead class="thead-light">
              <th>Nombre</th>
              <th>Correo de facturación</th>
              <th>Número telefónico</th>
              <th>Cedula</th>
              <th>Opciones</th>
            </thead>
            <tbody v-for="empresa in contactos">
              <tr>
                <td> {{empresa.nombre}} </td>
                <td> {{empresa.correo}} </td>
                <td> {{empresa.telefono}} </td>
                <td> {{empresa.cedula}} </td>
                <td>
                  <button type="button" class="btn btn-primary" @click="clickVerModalEditar(empresa)">
                    Editar </button>
                  <button type="button" class="btn btn-danger" @click="clickVerModalEliminar">Eliminar</button>
                  <button type="button" class="btn btn-info" @click="clickVerModalContactos(empresa)">Ver
                    Contactos</button>
                </td>
              </tr>

            </tbody>
          </table>
        </div>
      </div>
    </div>
  </form>
  <button type="button" class="btn btn-primary" @click="clickVerModalAgregar">Agregar</button>

  <!-----Modal Editar-->
  <modal v-if="l_verModalEditar" id="modalEditar">
    <div class="modal-header">
      <button type="button" class="close" @click="clickCerrarModalEditar">&times</button>
      <h2 class="modal-title">Ver Cliente</h2>
    </div>
    <ajax-form action="insertarCliente" :syncing.sync="syncing" :cloud-error.sync="cloudError" :form-data="o_cliente"
      :form-errors.sync="formErrors" :form-rules="formRules" @submitted="actualizarCliente">
      <div class="modal-body">
        <div class="row">
          <div class="form-group col">
            <label for="nombre">Nombre: </label>
            <input type="text" class="form-control" id="nomCliNuevo" placeholder="Digite el nombre"
              v-model="o_cliente.nombre" :class="[(formErrors.nombre || o_cliente.nombre !== undefined) && !o_cliente.nombre ?
             'is-invalid' : '']">
            <div class="invalid-feedback" v-text="modelo.l_errorNombre"></div>
          </div>
          <div class="form-group col">
            <label for="telefono">Teléfono: </label>
            <input type="number" max="99999999" class="form-control" id="telCliNuevo"
              placeholder="Digite el numero telefónico" v-model="o_cliente.telefono" :class="[(formErrors.telefono || o_cliente.telefono !== undefined) && !o_cliente.telefono ?
              'is-invalid' : '']">
            <div class="invalid-feedback" v-text="modelo.l_errorTelefono"></div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col">
            <label for="email">Email: </label>
            <input type="email" name="email"
              pattern="[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*@[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*[.][a-zA-Z]{1,5}"
              class="form-control" id="emaCliNuevo" placeholder="Digite el email" v-model="o_cliente.correo" :class="[(formErrors.correo || o_cliente.correo !== undefined) && !o_cliente.correo ?
              'is-invalid' : '']">
            <div class="invalid-feedback" v-text="modelo.l_errorCorreo"></div>
          </div>
          <div class="form-group col">
            <label for="cedula">Cédula(Jurídica o Física)</label>
            <input type="number" name="cedula" max="9999999999" placeholder="Digite la cédula" class="form-control"
              id="cedNuevo" v-model="o_cliente.cedula" :class="[(formErrors.cedula || o_cliente.cedula !== undefined) && !o_cliente.cedula ?
              'is-invalid' : '']">
            <div class="invalid-feedback" v-text="modelo.l_errorCedula"></div>
          </div>


        </div>
        <div class="row">
          <div class="form-group col">
            <label for="email">Email: </label>
            <input type="email" name="email"
              pattern="[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*@[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*[.][a-zA-Z]{1,5}"
              class="form-control" id="emaCliNuevo" placeholder="Digite el email" v-model="o_cliente.correo">
          </div>
          <div class="form-group col">
            <label for="cedula">Cédula(Jurídica o Física)</label>
            <input type="number" name="cedula" max="9999999999" placeholder="Digite la cédula"
              class="form-control" id="cedNuevo" v-model="o_cliente.cedula">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <ajax-button type="submit" :syncing="syncing" class="btn btn-primary">Guardar</ajax-button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
      </div>
    </ajax-form>
</modal>

<!--Modal Contactos-->
<modal v-if="l_verModalContactos" id="modalEditar">
  <div class="modal-header">
    <button v-if="!l_edito " type="button" class="close" @click="clickCerrarModalContactos">&times</button>
    <h2 class="modal-title">Ver Contactos</h2>
  </div>
  <div class="modal-body" v-for="empresa in o_cliente.Contacto">

    <div class="row" v-if="l_contacto.cedula==empresa.cedula">
      <div class="col-9">
        <ajax-form action="insertarCliente" :syncing.sync="syncing" :cloud-error.sync="cloudError"
          :form-data="o_contacto" :form-errors.sync="formErrors" :form-rules="formRules"
          @submitted="actualizarContacto">
          <div class="row">
            <div class="form-group col">
              <label for="nombre">Nombre: </label>
              <input type="text" class="form-control" id="nomCliNuevo" :value="empresa.nombre"
                v-model="o_contacto.nombre" :class="[(formErrors.nombre || o_contacto.nombre !== undefined) && !o_contacto.nombre ?
                           'is-invalid' : '']">
              <div class="invalid-feedback" v-text="modelo.l_errorNombre"></div>
            </div>
            <div class="form-group col">
              <label for="telefono">Teléfono: </label>
              <input type="number" max="99999999" class="form-control" id="telCliNuevo" :value="empresa.telefono"
                v-model="o_contacto.telefono" :class="[(formErrors.telefono || o_contacto.telefono !== undefined) && !o_contacto.telefono ?
                            'is-invalid' : '']">
              <div class="invalid-feedback" v-text="modelo.l_errorTelefono"></div>
            </div>
          </div>
          <div class="row">
            <div class="form-group col">
              <label for="email">Email: </label>
              <input type="email" name="email"
                pattern="[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*@[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*[.][a-zA-Z]{1,5}"
                class="form-control" id="emaCliNuevo" :value="empresa.correo" v-model="o_contacto.correo" :class="[(formErrors.correo || o_contacto.correo !== undefined) && !o_contacto.correo ?
                            'is-invalid' : '']">
              <div class="invalid-feedback" v-text="modelo.l_errorCorreo"></div>
            </div>
            <div class="form-group col">
              <label for="cedula">Cédula(Jurídica o Física)</label>
              <input type="number" name="cedula" max="9999999999" :value="empresa.cedula" class="form-control"
                id="cedNuevo" v-model="o_contacto.cedula" :class="[(formErrors.cedula || o_contacto.cedula !== undefined) && !o_contacto.cedula ?
                            'is-invalid' : '']">
              <div class="invalid-feedback" v-text="modelo.l_errorCedula"></div>
            </div>
          </div>
          <div class="row">
            <ajax-button type="submit" :syncing="syncing" class="btn btn-primary">Guardar</ajax-button>
          </div>
        </ajax-form>
      </div>
      <div class="col">
        <button type="button" class="btn btn-warning" @click="clickEditar(empresa)">Editar</button>
      </div>
    </div>

    <div class="row" v-else>
      <div class="col-9">
        <form>
          <div class="row">
            <div class="form-group col">
              <label for="nombre">Nombre: </label>
              <input type="text" class="form-control" id="nomCliNuevo" :value="empresa.nombre" readonly>
            </div>
            <div class="form-group col">
              <label for="telefono">Teléfono: </label>
              <input type="number" max="99999999" class="form-control" id="telCliNuevo" :value="empresa.telefono"
                readonly>
            </div>
          </div>
          <div class="row">
            <div class="form-group col">
              <label for="email">Email: </label>
              <input type="email" name="email" class="form-control" id="emaCliNuevo" :value="empresa.correo" readonly>
            </div>
            <div class="form-group col">
              <label for="cedula">Cédula(Jurídica o Física)</label>
              <input type="number" name="cedula" :value="empresa.cedula" class="form-control" id="cedNuevo" readonly>
            </div>
          </div>
        </form>
      </div>
      <div class="col">
        <button type="button" class="btn btn-warning" @click="clickEditar(empresa)">Editar</button>
      </div>
    </div>

  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" @click="clickCerrarModalContactos">Cerrar</button>
  </div>
  </form>

</modal>
<!------Modal Eliminar-->
<modal v-if="l_verModalEliminar" id="verArticulo">
  <div class="modal-header">
    <button type="button" class="close" @click="clickCerrarModalEliminar">&times</button>
    <h2 class="modal-title" id="AdvertenciaBorrado">¿Está seguro que desea borrar este Cliente?</h2>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary" type="button" id="Aceptar">Aceptar</button>
    <button class="btn btn-danger" type="button" id="Borrar" @click="clickCerrarModalEliminar">Cancelar</button>
  </div>

</modal>
<!--Modal Agregar-->
<modal v-if="l_verModalAgregar" id="modalAgregar">

  <div class="modal-header">
    <button type="button" class="close" @click="clickCerrarModalAgregar()">&times</button>
    <h5 class="modal-title" id="exampleModalLabel">Agregando un cliente/contacto</h5>
  </div>
  <ajax-form action="insertarCliente" :syncing.sync="syncing" :cloud-error.sync="cloudError" :form-data="o_cliente"
    :form-errors.sync="formErrors" :form-rules="formRules" @submitted="guardarCliente">
    <div class="modal-body">
      <div class="row">
        <div class="form-group col">
          <label for="nombre">Nombre: </label>
          <input type="text" class="form-control" id="nomCliNuevo" placeholder="Digite el nombre"
            v-model="o_cliente.nombre" :class="[(formErrors.nombre || o_cliente.nombre !== undefined) && !o_cliente.nombre ?
             'is-invalid' : '']">
          <div class="invalid-feedback" v-text="modelo.l_errorNombre"></div>
        </div>
        <div class="form-group col">
          <label for="telefono">Teléfono: </label>
          <input type="number" max="99999999" class="form-control" id="telCliNuevo"
            placeholder="Digite el numero telefónico" v-model="o_cliente.telefono" :class="[(formErrors.telefono || o_cliente.telefono !== undefined) && !o_cliente.telefono ?
              'is-invalid' : '']">
          <div class="invalid-feedback" v-text="modelo.l_errorTelefono"></div>
        </div>
      </div>
      <div class="row">
        <div class="form-group col">
          <label for="email">Email: </label>
          <input type="email" name="email"
            pattern="[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*@[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*[.][a-zA-Z]{1,5}"
            class="form-control" id="emaCliNuevo" placeholder="Digite el email" v-model="o_cliente.correo" :class="[(formErrors.correo || o_cliente.correo !== undefined) && !o_cliente.correo ?
              'is-invalid' : '']">
          <div class="invalid-feedback" v-text="modelo.l_errorCorreo"></div>
        </div>
        <div class="form-group col">
          <label for="cedula">Cédula(Jurídica o Física)</label>
          <input type="number" name="cedula" max="9999999999" placeholder="Digite la cédula" class="form-control"
            id="cedNuevo" v-model="o_cliente.cedula" :class="[(formErrors.cedula || o_cliente.cedula !== undefined) && !o_cliente.cedula ?
              'is-invalid' : '']">
          <div class="invalid-feedback" v-text="modelo.l_errorCedula"></div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <ajax-button type="submit" :syncing="syncing" class="btn btn-primary">Guardar</ajax-button>
      <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
    </div>
  </ajax-form>
  </div>

</modal>

</div>
<%- /* Expose server-rendered data as window.SAILS_LOCALS :: */ exposeLocalsToBrowser() %>